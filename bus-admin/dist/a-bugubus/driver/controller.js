app.controller("DriverListController",function($rootScope,$scope,$http,$state,$localStorage,$tableListService,$myHttpService){var selected=!1;$scope.selectAll=function(){selected=!selected,angular.forEach($scope.pageResponse.drivers,function(item){item.selected=selected})};var options={searchFormId:"J_search_form",listUrl:"api/driver/queryDriversByKeyword.htm"};$scope.delete=function(item){layer.confirm("您确定要删除吗？",{icon:3,title:"提示"},function(){$myHttpService.post("api/driver/deleteDriver.htm",item,function(){$state.go("app.driver.list",{},{reload:!0}),layer.msg("删除成功！",{offset:"100px"})})},function(index){layer.close(index)})},$tableListService.init($scope,options),$tableListService.get()}),app.controller("DriverEditController",function($rootScope,$scope,$myHttpService,$state,$localStorage,$stateParams,$filter,md5){$scope.editMode=!!$stateParams.id,$scope.editMode?($scope.driver={driverid:$stateParams.id},$myHttpService.post("api/driver/queryDriverInfo.htm",$scope.driver,function(data){$scope.driver=data.driver,$scope.driver.loginpwd=""},function(){setTimeout(function(){$state.go("app.driver.list")},3e3)}),$scope.submit=function(){""!=$scope.driver.loginpwd&&($scope.tempPwd=$scope.driver.loginpwd,$scope.driver.loginpwd=md5.createHash($scope.driver.loginpwd)),$myHttpService.post("api/driver/updateDriverInfo.htm",$scope.driver,function(){layer.msg("修改成功！",{offset:"100px"})},function(){$scope.driver.loginpwd=$scope.tempPwd})},$scope.delete=function(item){layer.confirm("您确定要删除吗？",{icon:3,title:"提示"},function(){$myHttpService.post("api/driver/deleteDriver.htm",item,function(){layer.msg("删除成功！",{offset:"100px"}),$state.go("app.driver.list",{},{reload:!0})})},function(index){layer.close(index)})}):($scope.driver={city:"武汉市",sex:"男"},$scope.submit=function(){$scope.tempPwd=$scope.driver.loginpwd,$scope.driver.loginpwd=md5.createHash($scope.driver.loginpwd),$myHttpService.post("api/driver/insertDriver.htm",$scope.driver,function(){layer.msg("添加成功！",{offset:"100px"}),$state.go("app.driver.add",{},{reload:!0})})}),$scope.$watch("dt",function(v){$scope.driver.birthday=$filter("date")(v,"yyyy-MM-dd")}),$scope.today=function(){$scope.dt=new Date},$scope.today(),$scope.clear=function(){$scope.dt=null},$scope.disabled=function(date,mode){return"day"===mode&&(0===date.getDay()||6===date.getDay())},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.dateOptions={formatYear:"yyyy",startingDay:1,"class":"datepicker"},$scope.dt=""});