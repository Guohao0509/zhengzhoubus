angular.module("app").directive("uiNav",["$timeout",function(){return{restrict:"AC",link:function(scope,el){var next,_window=$(window),_mb=768,wrap=$(".app-aside"),backdrop=".dropdown-backdrop";el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active"),_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault(),_this.next().is("ul")||_window.width()<_mb&&$(".app-aside").removeClass("show off-screen"),_this.next().is("ul")||_this.parent().addClass("active")}),el.on("mouseenter","a",function(e){if(next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<_mb||$(".app-aside-dock").length)){var top,_this=$(e.target),w_h=$(window).height(),offset=50,min=150;!_this.is("a")&&(_this=_this.closest("a")),_this.next().is("ul")&&(next=_this.next(),_this.parent().addClass("active"),top=_this.parent().position().top+offset,next.css("top",top),top+next.height()>w_h&&next.css("bottom",0),top+min>w_h&&next.css("bottom",w_h-top-offset).css("top","auto"),next.appendTo(wrap),next.on("mouseleave.nav",function(){$(backdrop).remove(),next.appendTo(_this.parent()),next.off("mouseleave.nav").css("top","auto").css("bottom","auto"),_this.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")}))}}),wrap.on("mouseleave",function(){next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove()})}}}]);