"use strict";app.controller("ListController",function($scope,$resource,$stateParams,$modal,$state){$scope.query=function(page,filter){var $com=$resource($scope.app.host+"/news/?page=:page&search=:filter",{page:"@page",filter:"@filter"});page=page?parseInt(page):1,$com.get({page:page,filter:filter},function(data){data.page_index=page,data.pages=[];var N=5,s=Math.floor(page/N)*N;s==page&&(s-=N),s+=1;for(var e=Math.min(data.page_count,s+N-1),i=s;e>=i;i++)data.pages.push(i);$scope.data=data,$scope.search_context=filter})},$scope.search=function(){$state.go("app.news.list",{search:$scope.search_context})};var selected=!1;$scope.selectAll=function(){selected=!selected,angular.forEach($scope.data.results,function(item){item.selected=selected})},$scope.exec=function(){if("1"==$scope.operate){var ids=[];if(angular.forEach($scope.data.results,function(item){item.selected&&ids.push(item.id)}),ids.length>0){var modalInstance=$modal.open({templateUrl:"admin/confirm.html",controller:"ConfirmController",size:"sm"});modalInstance.result.then(function(){var $com=$resource($scope.app.host+"/news/deletes/?");$com.delete({ids:ids.join(",")},function(){$state.go("app.news.list")})})}}},$scope.query($stateParams.page,$stateParams.search)}),app.controller("ConfirmController",["$scope","$modalInstance",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("DetailController",function($rootScope,$scope,$resource,$stateParams,$state){if($scope.edit_mode=!!$stateParams.id,$scope.edit_mode)var $com=$resource($scope.app.host+"/news/:id/?",{id:"@id"}),resp=$com.get({id:$stateParams.id},function(){$scope.data=resp});else $scope.data={};$scope.submit=function(){if($scope.edit_mode){var $com=$resource($scope.app.host+"/news/:id/?",{id:"@id"},{update:{method:"PUT"}});$com.update({id:$stateParams.id},$scope.data,function(){$state.go($rootScope.previousState,$rootScope.previousStateParams)})}else{var $com=$resource($scope.app.host+"/news/?");$com.save($scope.data,function(){$state.go("app.news.list")})}},$scope.delete=function(){var $com=$resource($scope.app.host+"/news/:id/?",{id:"@id"});$com.delete({id:$stateParams.id},function(){$state.go("app.news.list")})}});